# Excel 序列填充工具 (Excel Sequence Filler)

一个用于自动填充 Excel 表格中缺失桩号序列的 Python 工具。

## 功能概述

该工具扫描 Excel 文件的 D 列，识别已有的桩号数值，自动在相邻桩号之间填充缺失的序列编号，并复制相关列的内容和样式。

## 代码框架

```
excel-sequence-filler/
└── main.py          # 主程序文件
```

### 核心模块结构

| 函数名 | 功能 |
|--------|------|
| `as_int()` | 将单元格内容转换为整数 |
| `find_numeric_rows()` | 扫描 D 列，找出所有有数值的行 |
| `fill_missing_rows()` | **核心逻辑** - 填充缺失的桩号行 |
| `copy_row_style()` | 复制行样式（字体、边框、填充等） |
| `copy_context()` | 复制指定列的内容 |
| `set_stake_values()` | 设置 D/E 列的桩号值 |
| `fill_new_row_defaults()` | 为新插入行填充默认值 |
| `choose_input_file()` | 选择输入文件 |
| `main()` | 程序入口，处理命令行参数 |

## 工作逻辑

### 1. 数据扫描阶段

```
D列数据示例：975, 982, 1071, 1076... 
         ↓
扫描后得到：[(行3, 975), (行4, 982), (行5, 1071), ...]
```

### 2. 缺失检测与填充（核心算法）

```
┌─────────────────────────────────────────────────────┐
│  从后向前遍历相邻的数值行对                            │
│  (从后向前是为了避免插入行时影响未处理区间的行号)        │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│  计算 gap = 后一个值 - 前一个值 - 1                   │
│  例如：982 - 975 - 1 = 6 (需要填充 976-981)          │
└─────────────────────────────────────────────────────┘
                        ↓
┌─────────────────────────────────────────────────────┐
│  优先策略：                                          │
│  1. 先利用两行之间已有的空行填充                       │
│  2. 空行不够时，在后一个数值行前插入新行                │
└─────────────────────────────────────────────────────┘
```

### 3. 填充内容

对于每个新填充/插入的行：

| 操作 | 涉及列 |
|------|--------|
| 复制内容 | A, B, C, F 列 (`COPY_COLS`) |
| 设置桩号 | D 列 = 当前值, E 列 = 当前值 + 1 |
| 填充默认值 0 | 桥梁列 (7-11) 和涵洞列 (17-21) |
| 复制样式 | 所有列（仅新插入行） |

## 使用方法

### 基本用法

```bash
# 自动查找当前目录下的 xlsx 文件
python main.py

# 指定输入文件
python main.py data.xlsx

# 指定输出文件
python main. py data.xlsx -o result.xlsx

# 指定工作表
python main.py data.xlsx --sheet Sheet1
```

### 命令行参数

| 参数 | 类型 | 说明 |
|------|------|------|
| `input` | 位置参数 | 输入的 .xlsx 文件路径 |
| `-o, --output` | 可选参数 | 输出文件路径（默认：原文件名_filled. xlsx） |
| `--sheet` | 可选参数 | 工作表名称（默认：活动工作表） |

## 依赖

```bash
pip install openpyxl
```

## 示例

**处理前：**

| 行 | D列 | E列 |
|----|-----|-----|
| 3  | 975 | 976 |
| 4  | 978 | 979 |

**处理后：**

| 行 | D列 | E列 |
|----|-----|-----|
| 3  | 975 | 976 |
| 4  | 976 | 977 |
| 5  | 977 | 978 |
| 6  | 978 | 979 |

自动填充了缺失的 976、977 两个桩号。
